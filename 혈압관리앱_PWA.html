<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>혈압 관리</title>
  <link rel="manifest" href="manifest.json">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: system-ui, sans-serif; background:#f3f4f6; padding:16px; }
    h1 { font-size:20px; margin-bottom:12px; }
    .card { background:white; padding:12px; border-radius:12px; margin-bottom:12px; box-shadow:0 2px 6px rgba(0,0,0,.06); }
    input, button { width:100%; padding:8px; margin-top:6px; }
    button { background:#ef4444; color:white; border:none; border-radius:8px; }
    .high { color:#dc2626; font-weight:bold; }
  </style>
</head>
<body>
<h1>혈압 관리</h1>

<div class="card">
  <input type="date" id="date">
  <input id="sys" placeholder="최고혈압">
  <input id="dia" placeholder="최저혈압">
  <input id="note" placeholder="비고">
  <button onclick="add()">저장</button>
</div>

<div class="card"><canvas id="chart"></canvas></div>
<div class="card" id="list"></div>

<div class="card">
  <button onclick="exportCSV()">엑셀(CSV) 내보내기</button>
</div>

<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('sw.js');
}

const SYS_LIMIT = 140, DIA_LIMIT = 90;
let records = JSON.parse(localStorage.getItem('bp') || '[]');
let chart;

function save(){ localStorage.setItem('bp', JSON.stringify(records)); render(); }

function add(){
  if(!date.value||!sys.value||!dia.value) return;
  records.push({date:date.value, sys:+sys.value, dia:+dia.value, note:note.value});
  date.value=sys.value=dia.value=note.value='';
  save();
}

function render(){
  list.innerHTML='';
  records.forEach(r=>{
    const d=document.createElement('div');
    if(r.sys>=SYS_LIMIT||r.dia>=DIA_LIMIT) d.className='high';
    d.textContent=`${r.date}  ${r.sys}/${r.dia} ${r.note||''}`;
    list.appendChild(d);
  });
  if(chart) chart.destroy();
  chart=new Chart(document.getElementById('chart'),{
    type:'line',
    data:{labels:records.map(r=>r.date),
      datasets:[
        {label:'최고혈압',data:records.map(r=>r.sys)},
        {label:'최저혈압',data:records.map(r=>r.dia)}
      ]}
  });
}
function exportCSV(){
  let csv='날짜,최고혈압,최저혈압,비고\n';
  records.forEach(r=>csv+=`${r.date},${r.sys},${r.dia},${r.note||''}\n`);
  const a=document.createElement('a');
  a.href=URL.createObjectURL(new Blob([csv]));
  a.download='blood_pressure.csv';
  a.click();
}
render();
</script>
</body>
</html>
